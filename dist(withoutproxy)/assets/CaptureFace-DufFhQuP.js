import{r as n,j as e}from"./index-DavSq415.js";import{S as d}from"./sweetalert2.esm.all-BGf-Fe8G.js";import{a as j}from"./axios-B2YOV0tR.js";const k=()=>{const[s,m]=n.useState(null),[u,i]=n.useState(!1),x=localStorage.getItem("username"),f=localStorage.getItem("role"),o=n.useRef(null),l=n.useRef(null),g=async()=>{try{const t=await navigator.mediaDevices.getUserMedia({video:!0});o.current.srcObject=t,l.current=t}catch{d.fire({icon:"error",title:"Error",text:"Tidak dapat mengakses kamera"})}},h=()=>{l.current&&l.current.getTracks().forEach(t=>t.stop()),o.current&&(o.current.srcObject=null)},p=()=>{const t=o.current;if(t){const a=document.createElement("canvas");a.width=t.videoWidth,a.height=t.videoHeight,a.getContext("2d").drawImage(t,0,0,a.width,a.height);const c=a.toDataURL("image/jpeg");m(c),h()}},b=async()=>{var t,a;if(s){i(!0);try{const r=new FormData;r.append("image",s),r.append("name",x),r.append("role",f);const c=await j.post("https://api.nafismu.xyz/api/attendance-process/register",r);i(!1),d.fire({icon:"success",title:"Success",text:c.data.message})}catch(r){i(!1),d.fire({icon:"error",title:"Error",text:((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to register user"})}}};return e.jsxs("div",{className:"w-full max-w-lg mx-auto p-6 bg-white shadow-lg rounded-lg text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Rekam Wajah"}),e.jsx("div",{className:"relative w-full h-64 bg-gray-200 rounded-lg overflow-hidden flex items-center justify-center",children:s?e.jsx("img",{src:s,alt:"Captured",className:"w-full h-full object-cover"}):e.jsx("video",{ref:o,autoPlay:!0,className:"w-full h-full object-cover"})}),e.jsx("div",{className:"mt-4 flex flex-col gap-3",children:s?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{m(null),g()},className:"bg-gray-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-gray-600 transition",children:"Ambil Ulang"}),e.jsx("button",{onClick:b,className:"bg-blue-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-600 transition disabled:opacity-50",disabled:u,children:u?"Loading...":"Submit Absensi"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:g,className:"bg-blue-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-600 transition",children:"ðŸ“· Buka Kamera"}),e.jsx("button",{onClick:p,className:"bg-green-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-green-600 transition",children:"Ambil Foto"})]})})]})};export{k as default};
