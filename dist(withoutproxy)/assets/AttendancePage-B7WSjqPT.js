import{r as n,j as t}from"./index-DavSq415.js";import{S as o}from"./sweetalert2.esm.all-BGf-Fe8G.js";import{a as v}from"./axios-B2YOV0tR.js";const R=()=>{const[s,l]=n.useState(null),[w,c]=n.useState(null),[d,m]=n.useState(!1),f=localStorage.getItem("username"),a=n.useRef(null),i=n.useRef(null),u=async()=>{try{const e=await navigator.mediaDevices.getUserMedia({video:!0});a.current.srcObject=e,i.current=e}catch{o.fire({icon:"error",title:"Error",text:"Tidak dapat mengakses kamera"})}},x=()=>{i.current&&i.current.getTracks().forEach(e=>e.stop()),a.current&&(a.current.srcObject=null)},h=()=>{const e=document.createElement("canvas");e.width=a.current.videoWidth,e.height=a.current.videoHeight,e.getContext("2d").drawImage(a.current,0,0);const g=e.toDataURL("image/jpeg");l(g),x()},b=async()=>{if(s){m(!0);try{const e=new FormData;e.append("image",s),e.append("name",f);const r=(await v.post("https://api.nafismu.xyz/api/attendance-process/verify-face",e,{headers:{scheme:"https"}})).data;if(c(r),console.dir(r),r.success){const p=r.attendance.timestamp,j=r.user.name;o.fire({icon:"success",title:"Berhasil",text:`Absensi berhasil: ${j} pada ${p}`})}else o.fire({icon:"error",title:"Gagal",text:"Gagal melakukan absensi wajah"})}catch{o.fire({icon:"error",title:"Error",text:"Gagal mengirim data"})}finally{m(!1)}}};return t.jsxs("div",{className:"w-full max-w-lg mx-auto p-6 bg-white shadow-xl rounded-lg text-center",children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Sistem Absensi Face Recognition"}),t.jsx("div",{className:"relative w-full h-64 bg-gray-200 rounded-lg overflow-hidden flex items-center justify-center",children:s?t.jsx("img",{src:s,alt:"Captured",className:"w-full h-full object-cover"}):t.jsx("video",{ref:a,autoPlay:!0,className:"w-full h-full object-cover"})}),t.jsx("div",{className:"mt-4 flex flex-col gap-3",children:s?t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>{l(null),c(null),u()},className:"bg-gray-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-gray-600 transition",children:"Ambil Ulang"}),t.jsx("button",{onClick:b,className:"bg-blue-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-600 transition disabled:opacity-50",disabled:d,children:d?"Memproses...":"Submit Absensi"})]}):t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:u,className:"bg-blue-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-600 transition",children:"ðŸ“· Buka Kamera"}),t.jsx("button",{onClick:h,className:"bg-green-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-green-600 transition",children:"Ambil Foto"})]})})]})};export{R as default};
